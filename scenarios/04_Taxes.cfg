#textdomain wesnoth-DoS

[scenario]
    id = 04_Taxes
    name = _ "Полюдье"
    random_start_time=no
    experience_modifier=100
    map_data="{~add-ons/Deeds_of_Sir_Swine/maps/Taxes.map}"
    victory_when_enemies_defeated=no
    next_scenario=null
    carryover_percentage=20
    carryover_add=yes
    {TURNS 30 26 22}
    {SCENARIO_MUSIC "loyalists.ogg"}
    {EXTRA_SCENARIO_MUSIC "battle.ogg"}
    {DEFAULT_SCHEDULE}
    
    [story]
             [part]
              [background_layer]
               image=story/tavern.jpg
               scale_vertically=yes
               scale_horizontally=yes
               keep_aspect_ratio=yes
              [/background_layer]
              [background_layer]
               image=portraits/northerner.png
               scale_vertically=no
               scale_horizontally=no
               keep_aspect_ratio=yes
              [/background_layer]
            story={CAPTION ( _ "Северянин")} + _ "Выходит, этот Свин был очень самоуверенным огром."
            music=tavern.ogg
        [/part]
         [part]
              [background_layer]
               image=story/tavern.jpg
               scale_vertically=yes
               scale_horizontally=yes
               keep_aspect_ratio=yes
              [/background_layer]
              [background_layer]
               image=portraits/soldier.png
               scale_vertically=no
               scale_horizontally=no
               keep_aspect_ratio=yes
              [/background_layer]
            story={CAPTION ( _ "Солдат")} + _ "Ага. А всё потому, что по морде давно не получал. Вот если бы какой-нибудь лорд дал ему просраться, может, и не потеряли бы Южную Марку..."
        [/part]
         [part]
              [background_layer]
               image=story/tavern.jpg
               scale_vertically=yes
               scale_horizontally=yes
               keep_aspect_ratio=yes
              [/background_layer]
              [background_layer]
               image=portraits/northerner.png
               scale_vertically=no
               scale_horizontally=no
               keep_aspect_ratio=yes
              [/background_layer]
            story={CAPTION ( _ "Северянин")} + _ "А что, потеряли?"
        [/part]
         [part]
              [background_layer]
               image=story/tavern.jpg
               scale_vertically=yes
               scale_horizontally=yes
               keep_aspect_ratio=yes
              [/background_layer]
              [background_layer]
               image=portraits/soldier.png
               scale_vertically=no
               scale_horizontally=no
               keep_aspect_ratio=yes
              [/background_layer]
            story={CAPTION ( _ "Солдат")} + _ "Тьфу, это я так. Слушай всё по порядку."
        [/part]
         [part]
              [background_layer]
               image=story/tavern.jpg
               scale_vertically=yes
               scale_horizontally=yes
               keep_aspect_ratio=yes
              [/background_layer]
              [background_layer]
               image=portraits/northerner.png
               scale_vertically=no
               scale_horizontally=no
               keep_aspect_ratio=yes
              [/background_layer]
            story={CAPTION ( _ "Северянин")} + _ "А что насчёт медвежьих шкур? Лорды оценили их?"
        [/part]
         [part]
              [background_layer]
               image=story/tavern.jpg
               scale_vertically=yes
               scale_horizontally=yes
               keep_aspect_ratio=yes
              [/background_layer]
              [background_layer]
               image=portraits/soldier.png
               scale_vertically=no
               scale_horizontally=no
               keep_aspect_ratio=yes
              [/background_layer]
            story={CAPTION ( _ "Солдат")} + _ "Пхах, оценили, да! Магот её в конюшне постелил, а Гракк, по слухам, подтирал ей задницу. До Каррака шкура не дошла, но если б дошла, Свет Свидетель, он бы сделал с ней что похуже!"
        [/part]
         [part]
              [background_layer]
               image=story/tavern.jpg
               scale_vertically=yes
               scale_horizontally=yes
               keep_aspect_ratio=yes
              [/background_layer]
              [background_layer]
               image=portraits/northerner.png
               scale_vertically=no
               scale_horizontally=no
               keep_aspect_ratio=yes
              [/background_layer]
            story={CAPTION ( _ "Северянин")} + _ "Не оценили лорды подвиг Свина."
        [/part]
        [part]
              [background_layer]
               image=story/tavern.jpg
               scale_vertically=yes
               scale_horizontally=yes
               keep_aspect_ratio=yes
              [/background_layer]
              [background_layer]
               image=portraits/soldier.png
               scale_vertically=no
               scale_horizontally=no
               keep_aspect_ratio=yes
              [/background_layer]
            story={CAPTION ( _ "Солдат")} + _ "Если бы не война, они хотя бы поржали. А так - ты учитывай, с какими новостями им передавали эти шкуры. Сам понимаешь..."
        [/part]
          [part]
            [background_layer]
               image=story/tavern.jpg
               scale_vertically=yes
               scale_horizontally=yes
               keep_aspect_ratio=yes
              [/background_layer]
              [background_layer]
               image=portraits/bard.png
               scale_vertically=no
               scale_horizontally=no
               keep_aspect_ratio=yes
              [/background_layer]
            story={CAPTION ( _ "Бард")} + _ "<i>Богатырским сном спал сэр Гарка: два дня и две ночи не подымался с кровати. К обеду третьего дня же он выступил с войском, дабы собрать то, что принадлежит ему по праву, и вдохновить подданных на подвиги!</i>"
        [/part]
          [part]
              [background_layer]
               image=story/tavern.jpg
               scale_vertically=yes
               scale_horizontally=yes
               keep_aspect_ratio=yes
              [/background_layer]
              [background_layer]
               image=portraits/soldier.png
               scale_vertically=no
               scale_horizontally=no
               keep_aspect_ratio=yes
              [/background_layer]
            story={CAPTION ( _ "Солдат")} + _ "Сейчас про полюдье рассказывать будет."
        [/part]
         [part]
              [background_layer]
               image=story/tavern.jpg
               scale_vertically=yes
               scale_horizontally=yes
               keep_aspect_ratio=yes
              [/background_layer]
              [background_layer]
               image=portraits/northerner.png
               scale_vertically=no
               scale_horizontally=no
               keep_aspect_ratio=yes
              [/background_layer]
            story={CAPTION ( _ "Северянин")} + _ "Да нежели там есть про что рассказывать?"
        [/part]
          [part]
              [background_layer]
               image=story/tavern.jpg
               scale_vertically=yes
               scale_horizontally=yes
               keep_aspect_ratio=yes
              [/background_layer]
              [background_layer]
               image=portraits/soldier.png
               scale_vertically=no
               scale_horizontally=no
               keep_aspect_ratio=yes
              [/background_layer]
            story={CAPTION ( _ "Солдат")} + _ "Ага. Свин не только свой замок, но и все деревни в помойку превратил. Сейчас сам всё услышишь."
        [/part]
    [/story]
    
    [side]
        controller=human
        side=1
        {GOLD 140 120 0}
        {SWINE_STATS}
        team_name=swine
        user_team_name= _ "Сэр Гарка"
        color=red
        fog=no
        shroud=no
    [/side]
    [side]
        controller=ai
        side=2
        {GOLD 100 140 0}
        team_name=bears
        user_team_name= _ "Селяне"
        color=black
        type=Fugitive
        id=rebel
        name="Деревенский староста"
        recruit=Footpad, Ruffian, Woodsman, Peasant
        hidden=no
#       [unit]
#        facing="se"
#        name="Гираван"
#        type="Footpad"
#        x=14
#        y=7
#    [/unit]
#    [unit]
#        facing="n"
#        name="Йонер"
#        type="Footpad"
#        x=16
#        y=7
#    [/unit]
    [unit]
        facing="ne"
        name="Страж-мятежник"
        ai_special=guardian
        type="Outlaw"
        [modifications]
            {TRAIT_LOYAL}
            #ifndef EASY
            {TRAIT_RESILIENT}
            #endif
        [/modifications]
        x=18
        y=7
    [/unit]
    [unit]
        facing="ne"
        name="Страж-мятежник"
        ai_special=guardian
        type="Bandit"
        [modifications]
            {TRAIT_LOYAL}
            #ifndef EASY
            {TRAIT_RESILIENT}
            #endif
        [/modifications]
        x=15
        y=9
    [/unit]
    [unit]
        facing="ne"
        name="Лесник-мятежник"
        #ifdef EASY
        type="Woodsman"
        #else
        type="Poacher"
        #endif
        ai_special=guardian
        [modifications]
            [advancement]
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_AMBUSH}
                    [/abilities]
                [/effect]
            [/advancement]
        [/modifications]
        x=16
        y=18
    [/unit]
    [unit]
        facing="se"
        name="Лесник-мятежник"
        #ifdef EASY
        type="Woodsman"
        #else
        type="Poacher"
        #endif
         [modifications]
            [advancement]
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_AMBUSH}
                    [/abilities]
                [/effect]
            [/advancement]
        [/modifications]
        ai_special=guardian
        x=23
        y=19
    [/unit]
    [unit]
        facing="sw"
        name="Лесник-мятежник"
        #ifdef EASY
        type="Woodsman"
        #else
        type="Poacher"
        #endif
         [modifications]
            [advancement]
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_AMBUSH}
                    [/abilities]
                [/effect]
            [/advancement]
        [/modifications]
        ai_special=guardian
        x=4
        y=19
    [/unit]
    [unit]
        facing="nw"
        name="Лесник-мятежник"
        #ifdef EASY
        type="Woodsman"
        #else
        type="Poacher"
        #endif
         [modifications]
            [advancement]
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_AMBUSH}
                    [/abilities]
                [/effect]
            [/advancement]
        [/modifications]
        ai_special=guardian
        x=7
        y=14
    [/unit]
    [unit]
        facing="se"
        name="Лесник-мятежник"
        #ifdef EASY
        type="Woodsman"
        #else
        type="Poacher"
        #endif
         [modifications]
            [advancement]
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_AMBUSH}
                    [/abilities]
                [/effect]
            [/advancement]
        [/modifications]
        ai_special=guardian
        x=15
        y=29
    [/unit]
    [/side]
    [side]
    controller="ai"
    fog=no
    gold=0
    hidden=no
    income=0
    no_leader=yes
    share_vision="all"
    shroud=no
    side=3
    team_name=swine
    user_team_name= _ "Наёмники"
    [unit]
    id=merc1
        facing="n"
        name="Веснотский наёмник"
        type="Cavalryman"
        x=2
        y=26
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_INTELLIGENT}
        [/modifications]
    [/unit]
    [unit]
    id=merc2
        facing="ne"
        name="Веснотский наёмник"
        type="Cavalryman"
        x=1
        y=27
        [modifications]
            {TRAIT_STRONG}
            {TRAIT_INTELLIGENT}
        [/modifications]
    [/unit]
    [unit]
    id=merc3
        facing="ne"
        name="Веснотский кондатьер"
        type="Dragoon"
        x=1
        y=26
        [modifications]
            [trait]
                id=veteran_mercenary
                male_name=_"veteran mercenary"
                female_name=_"female^veteran mercenary"
                description=_"leadership ability"
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_LEADERSHIP}
                    [/abilities]
                [/effect]
                [effect]
                    apply_to=attack
                    range=melee
                    increase_damage=1
                [/effect]
                [effect]
                    apply_to=hitpoints
                    increase_total=1
                [/effect]
            [/trait]
            {TRAIT_INTELLIGENT}
        [/modifications]
    [/unit]
    [/side]
    [event]
        name=last breath
        [filter]
            id=Swine
            [or]
                id=Cleric
            [/or]
        [/filter]
        [message]
            speaker=unit
            message= _ "No!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

     [event]
        name=prestart
        [objectives]
            [objective]
                description= _ "Захватить все поселения"
                condition=win
            [/objective]
             [objective]
                description= _ "Убить лидера мятежников"
                condition=win
            [/objective]
            [objective]
                description= _ "Смерть сэра Свина"
                condition=lose
            [/objective]
            [objective]
                description= _ "Смерть Советника"
                condition=lose
            [/objective]
            [objective]
                description= _ "Turns run out"
                condition=lose
            [/objective]
            [gold_carryover]
                bonus=yes
                carryover_percentage=20
            [/gold_carryover]
            [note]
                description=_"It is recommended to recruit with the Advisor and fight with Sir Swine"
            [/note]
        [/objectives]
        [recall]
        id=Cleric
        [/recall]
    [/event]
         [event]
        name=start
        [message]
            speaker=rebel
            message=_"Вонючий свин! Зачем ты явился в нашу долину?"
        [/message]
        [message]
            speaker=Swine
            message=_"Что?! Это моя долина, как и все вы, хр. Преклони колени и неси мне свои денежки!"
        [/message]
          [message]
            speaker=rebel
            message=_"Мы уже заплатили тебе. Больше ты ничего не получишь."
        [/message]
        [message]
            speaker=Swine
            message=_"Как ты смеешь, смерд! Я - твой господин, и буду брать столько налогов, сколько захочу!"
        [/message]
        [message]
            speaker=Cleric
            message=_"Милорд, пожалуйста. Вы ведь не понижали налоги даже во время засухи. Может случиться восстание."
        [/message]
         [message]
            speaker=Swine
            message=_"И что? Это моя долина! И я, хр, распоряжаюсь ей, как хочу! Быстро заплатили мне ещё одну, хр, норму!"
        [/message]
         [message]
            speaker=rebel
            message=_"Ну уж нет. В отличие от своего отца, ты забыл, что подданных надо защищать. Мы сами отбиваемся от бандитов, сами следим за заставой и терпим твои жестокие повинности. Долой! Убирайся из долины, мы убьём тебя!"
        [/message]
           [message]
            speaker=Swine
            message=_"Что?! Бунт?! Хр! Воины! Подавить, подавить, подавить их! Убить мятежников! И забрать моё золото!"
        [/message]
        [/event]
        [event]
        name=side_3_turn_1
        {MOVE_UNIT id=merc1 12 31}
         {MOVE_UNIT id=merc2 11 32}
     {MOVE_UNIT id=merc3 11 31}

        [store_gold]
            variable=swinegold
            side=1
        [/store_gold]       
        [message]
        speaker=merc3
        message=_"Мир вам, сэр рыцарь! Вам, кажется, не помешает помощь? Я и мои люди - лучшие наёмные кавалеристы во всём Весноте! Всего за 70 золотых мы поможем вам усмирить чернь. Что скажете?"
        [/message]
         [message]
            speaker=Swine
            message=_"Как мне с ними быть, хр-р..."
            [option]
                image="icons/coins_copper.png"
                description=_"Нанять (-70 золотых)"
                [show_if]
                    {VARIABLE_CONDITIONAL swinegold greater_than_equal_to 70}
                [/show_if]
                [command]
                [sound]
                    name=gold.ogg
                [/sound]
    
                [gold]
                    amount=-70
                    side=1
                [/gold]
                [modify_unit]
                    [filter]
                        side=3
                    [/filter]
                    side=1
                [/modify_unit]
                [message]
            speaker=Swine
            message=_"Ладно уж! Беру вас, хр, но что б золото своё отработали!"
            [/message]
             [message]
              speaker=merc3
              message=_"Без проблем, сэр рыцарь."
             [/message]
              [message]
            speaker=Cleric
            message=_"Хорошо, что вы наняли всадников, милорд. Они помогут нам добраться до деревень раньше мятежников."
            [/message]
            [/command]
            [/option]
            [option]
                image="icons/coins_copper.png"
                description=_"Нанять с долгом (-70 золотых, золото уходит с минус)"
                [show_if]
                    {VARIABLE_CONDITIONAL swinegold less_than 70}
                [/show_if]
                [command]
                [sound]
                    name=gold.ogg
                [/sound]
    
                [gold]
                    amount=-70
                    side=1
                [/gold]
                [modify_unit]
                    [filter]
                        side=3
                    [/filter]
                    side=1
                [/modify_unit]
                [message]
            speaker=Swine
            message=_"Ладно уж! Хр, золотых пока чуток, хр, не хватает, дам вам $swinegold| авансом, но ща с черни золото выбьем и остальное сразу, хр, доплачу."
            [/message]
             [message]
              speaker=merc3
              message=_"Без проблем, сэр рыцарь."
             [/message]
              [message]
            speaker=Cleric
            message=_"Хорошо, что вы наняли всадников, милорд. Они помогут нам добраться до деревень раньше мятежников."
            [/message]
            [/command]
            [/option]
            [option]
                image="icons/coins_copper.png"
                description=_"Прогнать"
                [command]
                 [message]
            speaker=Swine
            message=_"Ну уж нет! Проваливайте из моих земель, вымогатели! Не то я вас, хр, как мятежников..!"
            [/message]
             [message]
              speaker=merc3
              message=_"Воля ваша, сэр рыцарь. Нам не нужны проблемы."
             [/message]
             [kill]
             side=3
             animate=no
             fire_event=no
             [/kill]
             [message]
             speaker=Cleric
             message= _ "Стоило ли поступать так опрометчиво, милорд? Теперь нам не занять деревни раньше мятежников."
             [/message]
               [message]
            speaker=Swine
            message=_"Хр, тоже мне! Мои воины убьют мятежников и займут деревни."
            [/message]
            [/command]
            [/option]
            [/message]
            {CLEAR_VARIABLE swinegold}
            [/event]

    [event]
        id=tax
        [message]
            speaker=Swine
            message= _ "Это по праву МОЁ золото, ХР!"
        [/message]
    [/event]
    
    [event]
        id=rise
        [message]
            speaker=unit
            message= _ "Поднимайтесь, поднимайтесь, братцы!"
        [/message]
    [/event]

    [event]
        name=capture
        first_time_only=no

        [filter_condition]
            [variable]
                name=village_$x1|_$y1|_cleared
                boolean_not_equals=yes
            [/variable]
        [/filter_condition]
        {VARIABLE village_$x1|_$y1|_cleared yes}
        [if]
            [variable]
                name=unit.side
                equals=1
            [/variable]
            [then]
                [fire_event]
                    id=tax
                [/fire_event]
                [floating_text]
                    x,y=$x1,$y1
                    text=_"+10 gold"
                [/floating_text]
                [sound]
                    name=gold.ogg
                [/sound]
                [gold]
                    amount=10
                    side=1
                [/gold]
            [/then]
            [elseif]
                #can't cause villagers to rebel if the rebellion's leader is dead
                [have_unit]
                    side=2
                    canrecruit=yes
                [/have_unit]
                [fire_event]
                    id=rise
                    [primary_unit]
                        x,y=$x1,$y1
                    [/primary_unit]
                [/fire_event]
                [then]
                [random_placement]
                    num_items=1
                    variable=guard_location
                    [filter_location]
                        [filter_adjacent_location]
                            x,y=$x1,$y1
                        [/filter_adjacent_location]
                    [/filter_location]
                    [command]
                        [move_unit_fake]
                            side=2
                            type=Thug
                            x=$x1,$guard_location.x
                            y=$y1,$guard_location.y
                        [/move_unit_fake]

                        [unit]
                            type=Thug
                            side=2
                            x,y=$guard_location.x,$guard_location.y
                            random_traits=yes
                        [/unit]
                        [modify_unit]
                            [filter]
                                x,y=$guard_location.x,$guard_location.y
                            [/filter]
                            moves=2
                        [/modify_unit]
                    [/command]
                [/random_placement]
                {CLEAR_VARIABLE guard_location}
                [/then]
            [/elseif]
            [else]
            [/else]
        [/if]
    [/event]

    [event]
        name=last breath
        [filter]
            side=2
            canrecruit=yes
        [/filter]
        [message]
            speaker=unit
            message= _ "Отнимаете последнее, твари... Да будь ты проклят, Сэр Свин. Если не я то кто-нибудь другой рано или поздно сотрет тебя с лица земли! Агрх..."
        [/message]
    [/event]

    [event]
        name=die
        [filter]
            side=2
            canrecruit=yes
        [/filter]
        [message]
            speaker=Swine
            message= _ "TODO"
        [/message]
    [/event]

    [event]
        name=capture,turn refresh
        first_time_only=no
        # When capturing a village we check if we own all villages of the map
        [if]
            [not]
                [have_location]
                    terrain=*^V*
                    [not]
                        owner_side=1
                    [/not]
                [/have_location]
            [/not]
            [and]
                [not]
                    [have_unit]
                        side=2
                        canrecruit=yes
                    [/have_unit]
                [/not]
            [/and]
            [then]
                [endlevel]
                    result=victory
                    bonus=yes
                [/endlevel]
            [/then]
        [/if]
    [/event]
    
    [event]
        name=victory

        [store_villages]
            variable=villages
        [/store_villages]

        [foreach]
            array=villages
            [do]
                {VARIABLE_OP village_var value "village_$this_item.x|_$this_item.y|_cleared"}

                {CLEAR_VARIABLE $village_var}
            [/do]
        [/foreach]
    [/event]
[/scenario]

                   
